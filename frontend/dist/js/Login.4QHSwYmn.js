import{x as e,aB as a,aA as s,r,X as o,h as l,ag as n,y as i,z as t,A as u,P as d,H as c,L as g,M as m,a4 as p,u as f}from"./vue-vendor.C3rdx7ZB.js";import{r as v,u as h,_ as w}from"./index.Cjh-Y3mq.js";import{E as y,D as b}from"./element-plus.BDp-1BTq.js";import"./utils.3cDF09Hu.js";const _=e=>v.get("/auth/security/lock-status",{params:{username:e}}),x={class:"login-container"},k={class:"login-box"},q=w(e({__name:"Login",setup(e){const v=a(),w=s(),q=h(),V=r(),L=o({username:"",password:""}),j=o({username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",trigger:"blur"},{min:2,max:20,message:"ç”¨æˆ·åé•¿åº¦åœ¨ 2 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:6,max:20,message:"å¯†ç é•¿åº¦åœ¨ 6 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}]}),z=r(!1),I=async()=>{var e;if(!V.value)return;if(await V.value.validate().catch((()=>!1))){if(L.username.trim())try{const a=await _(L.username.trim());if(null==(e=a.data)?void 0:e.isLocked){const e=a.data.remainingMinutes||0;return void y.warning(`è´¦æˆ·å·²è¢«é”å®šï¼Œè¯·${e}åˆ†é’ŸåŽå†è¯•`)}}catch(a){console.error("æ£€æŸ¥é”å®šçŠ¶æ€å¤±è´¥:",a)}z.value=!0;try{console.log("ðŸ” å¼€å§‹ç™»å½•..."),await q.login(L),console.log("âœ… ç™»å½•æˆåŠŸ"),y.success("ç™»å½•æˆåŠŸ");const e=w.query.redirect||"/dashboard";console.log("ðŸ”€ è·³è½¬åˆ°:",e),await v.push(e)}catch(a){console.error("âŒ ç™»å½•å¤±è´¥:",a)}finally{z.value=!1}}};return l((async()=>{console.log("ðŸ“„ ç™»å½•é¡µé¢æŒ‚è½½");if("forced_logout"===w.query.message&&y.warning("æ‚¨çš„è´¦æˆ·åœ¨å…¶ä»–åœ°æ–¹ç™»å½•ï¼Œå·²è‡ªåŠ¨é€€å‡º"),q.isLoggedIn&&q.userInfo){console.log("ðŸ‘¤ ç”¨æˆ·å·²ç™»å½•ï¼Œå‡†å¤‡è·³è½¬");const e=w.query.redirect||"/dashboard";return console.log("ðŸ”€ è·³è½¬åˆ°:",e),void(await v.push(e))}if(q.token&&!q.userInfo){console.log("ðŸ”„ æ£€æµ‹åˆ°tokenï¼Œå°è¯•æ¢å¤ç™»å½•çŠ¶æ€...");if(await q.initUser()){const e=w.query.redirect||"/dashboard";console.log("ðŸ”€ çŠ¶æ€æ¢å¤æˆåŠŸï¼Œè·³è½¬åˆ°:",e),await v.push(e)}}})),(e,a)=>{const s=n("el-input"),r=n("el-form-item"),o=n("el-button");return t(),i("div",x,[u("div",k,[a[2]||(a[2]=u("div",{class:"login-header"},[u("div",{class:"logo"},"ðŸ»"),u("h2",null,"FiveBear ç³»ç»Ÿç™»å½•")],-1)),d(f(b),{ref_key:"loginFormRef",ref:V,model:L,rules:j,class:"login-form",onKeyup:p(I,["enter"])},{default:c((()=>[d(r,{prop:"username"},{default:c((()=>[d(s,{modelValue:L.username,"onUpdate:modelValue":a[0]||(a[0]=e=>L.username=e),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å","prefix-icon":"User",size:"large",clearable:""},null,8,["modelValue"])])),_:1}),d(r,{prop:"password"},{default:c((()=>[d(s,{modelValue:L.password,"onUpdate:modelValue":a[1]||(a[1]=e=>L.password=e),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ","prefix-icon":"Lock",size:"large","show-password":"",clearable:""},null,8,["modelValue"])])),_:1}),d(r,null,{default:c((()=>[d(o,{type:"primary",size:"large",loading:z.value,class:"login-btn",onClick:I},{default:c((()=>[g(m(z.value?"ç™»å½•ä¸­...":"ç™»å½•"),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model","rules"]),a[3]||(a[3]=u("div",{class:"login-footer"},[u("p",null,"Â© 2024 FiveBear System. All rights reserved.")],-1))])])}}}),[["__scopeId","data-v-8c0dc6d8"]]);export{q as default};
