const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/404.CkAfTJnS.js","js/vue-vendor.C3rdx7ZB.js","js/element-plus.BDp-1BTq.js","js/utils.3cDF09Hu.js","css/404.CXua_yea.css","js/Dashboard.DkD7UrZu.js","css/Dashboard.BZ9UlbPX.css","js/Login.4QHSwYmn.js","css/Login.DoGwGpxB.css","js/PlatformManager.ChHwjVzh.js","js/platform.D35QYocM.js","css/PlatformManager.BbtwROAG.css","js/Sites.BoV43usS.js","css/Sites.CG2TwVGp.css","js/Sites.CB1LDPkl.js","css/Sites.uq30_hvp.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,o,n)=>((t,o,n)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n)(t,"symbol"!=typeof o?o+"":o,n);import{aw as o,r as n,x as r,c as s,h as a,S as i,ag as c,y as l,J as u,z as d,P as h,H as m,A as g,G as p,u as v,D as f,ax as k,ay as b,at as y,az as w}from"./vue-vendor.C3rdx7ZB.js";import{E as S,a as A,c as E,b as _,d as C,e as R,i as T}from"./element-plus.BDp-1BTq.js";import{S as I,a as P,b as L}from"./utils.3cDF09Hu.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var M={name:"zh-cn",el:{breadcrumb:{label:"é¢åŒ…å±‘"},colorpicker:{confirm:"ç¡®å®š",clear:"æ¸…ç©º",defaultLabel:"é¢œè‰²é€‰æ‹©å™¨",description:"å½“å‰é¢œè‰² {color}ï¼ŒæŒ‰ Enter é”®é€‰æ‹©æ–°é¢œè‰²",alphaLabel:"é€‰æ‹©é€æ˜åº¦çš„å€¼"},datepicker:{now:"æ­¤åˆ»",today:"ä»Šå¤©",cancel:"å–æ¶ˆ",clear:"æ¸…ç©º",confirm:"ç¡®å®š",dateTablePrompt:"ä½¿ç”¨æ–¹å‘é”®ä¸ Enter é”®å¯é€‰æ‹©æ—¥æœŸ",monthTablePrompt:"ä½¿ç”¨æ–¹å‘é”®ä¸ Enter é”®å¯é€‰æ‹©æœˆä»½",yearTablePrompt:"ä½¿ç”¨æ–¹å‘é”®ä¸ Enter é”®å¯é€‰æ‹©å¹´ä»½",selectedDate:"å·²é€‰æ—¥æœŸ",selectDate:"é€‰æ‹©æ—¥æœŸ",selectTime:"é€‰æ‹©æ—¶é—´",startDate:"å¼€å§‹æ—¥æœŸ",startTime:"å¼€å§‹æ—¶é—´",endDate:"ç»“æŸæ—¥æœŸ",endTime:"ç»“æŸæ—¶é—´",prevYear:"å‰ä¸€å¹´",nextYear:"åä¸€å¹´",prevMonth:"ä¸Šä¸ªæœˆ",nextMonth:"ä¸‹ä¸ªæœˆ",year:"å¹´",month1:"1 æœˆ",month2:"2 æœˆ",month3:"3 æœˆ",month4:"4 æœˆ",month5:"5 æœˆ",month6:"6 æœˆ",month7:"7 æœˆ",month8:"8 æœˆ",month9:"9 æœˆ",month10:"10 æœˆ",month11:"11 æœˆ",month12:"12 æœˆ",weeks:{sun:"æ—¥",mon:"ä¸€",tue:"äºŒ",wed:"ä¸‰",thu:"å››",fri:"äº”",sat:"å…­"},weeksFull:{sun:"æ˜ŸæœŸæ—¥",mon:"æ˜ŸæœŸä¸€",tue:"æ˜ŸæœŸäºŒ",wed:"æ˜ŸæœŸä¸‰",thu:"æ˜ŸæœŸå››",fri:"æ˜ŸæœŸäº”",sat:"æ˜ŸæœŸå…­"},months:{jan:"ä¸€æœˆ",feb:"äºŒæœˆ",mar:"ä¸‰æœˆ",apr:"å››æœˆ",may:"äº”æœˆ",jun:"å…­æœˆ",jul:"ä¸ƒæœˆ",aug:"å…«æœˆ",sep:"ä¹æœˆ",oct:"åæœˆ",nov:"åä¸€æœˆ",dec:"åäºŒæœˆ"}},inputNumber:{decrease:"å‡å°‘æ•°å€¼",increase:"å¢åŠ æ•°å€¼"},select:{loading:"åŠ è½½ä¸­",noMatch:"æ— åŒ¹é…æ•°æ®",noData:"æ— æ•°æ®",placeholder:"è¯·é€‰æ‹©"},dropdown:{toggleDropdown:"åˆ‡æ¢ä¸‹æ‹‰é€‰é¡¹"},mention:{loading:"åŠ è½½ä¸­"},cascader:{noMatch:"æ— åŒ¹é…æ•°æ®",loading:"åŠ è½½ä¸­",placeholder:"è¯·é€‰æ‹©",noData:"æš‚æ— æ•°æ®"},pagination:{goto:"å‰å¾€",pagesize:"æ¡/é¡µ",total:"å…± {total} æ¡",pageClassifier:"é¡µ",page:"é¡µ",prev:"ä¸Šä¸€é¡µ",next:"ä¸‹ä¸€é¡µ",currentPage:"ç¬¬ {pager} é¡µ",prevPages:"å‘å‰ {pager} é¡µ",nextPages:"å‘å {pager} é¡µ",deprecationWarning:"ä½ ä½¿ç”¨äº†ä¸€äº›å·²è¢«åºŸå¼ƒçš„ç”¨æ³•ï¼Œè¯·å‚è€ƒ el-pagination çš„å®˜æ–¹æ–‡æ¡£"},dialog:{close:"å…³é—­æ­¤å¯¹è¯æ¡†"},drawer:{close:"å…³é—­æ­¤å¯¹è¯æ¡†"},messagebox:{title:"æç¤º",confirm:"ç¡®å®š",cancel:"å–æ¶ˆ",error:"è¾“å…¥çš„æ•°æ®ä¸åˆæ³•!",close:"å…³é—­æ­¤å¯¹è¯æ¡†"},upload:{deleteTip:"æŒ‰ Delete é”®å¯åˆ é™¤",delete:"åˆ é™¤",preview:"æŸ¥çœ‹å›¾ç‰‡",continue:"ç»§ç»­ä¸Šä¼ "},slider:{defaultLabel:"æ»‘å—ä»‹äº {min} è‡³ {max}",defaultRangeStartLabel:"é€‰æ‹©èµ·å§‹å€¼",defaultRangeEndLabel:"é€‰æ‹©ç»“æŸå€¼"},table:{emptyText:"æš‚æ— æ•°æ®",confirmFilter:"ç­›é€‰",resetFilter:"é‡ç½®",clearFilter:"å…¨éƒ¨",sumText:"åˆè®¡"},tour:{next:"ä¸‹ä¸€æ­¥",previous:"ä¸Šä¸€æ­¥",finish:"ç»“æŸå¯¼è§ˆ"},tree:{emptyText:"æš‚æ— æ•°æ®"},transfer:{noMatch:"æ— åŒ¹é…æ•°æ®",noData:"æ— æ•°æ®",titles:["åˆ—è¡¨ 1","åˆ—è¡¨ 2"],filterPlaceholder:"è¯·è¾“å…¥æœç´¢å†…å®¹",noCheckedFormat:"å…± {total} é¡¹",hasCheckedFormat:"å·²é€‰ {checked}/{total} é¡¹"},image:{error:"åŠ è½½å¤±è´¥"},pageHeader:{title:"è¿”å›"},popconfirm:{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ"},carousel:{leftArrow:"ä¸Šä¸€å¼ å¹»ç¯ç‰‡",rightArrow:"ä¸‹ä¸€å¼ å¹»ç¯ç‰‡",indicator:"å¹»ç¯ç‰‡åˆ‡æ¢è‡³ç´¢å¼• {index}"}}};const O=new class{constructor(){t(this,"socket",null),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",5),t(this,"reconnectInterval",3e3),t(this,"isConnecting",!1),t(this,"isAuthenticated",!1)}connect(e){var t;if((null==(t=this.socket)?void 0:t.readyState)!==WebSocket.OPEN&&!this.isConnecting)try{this.isConnecting=!0,console.log("ğŸ”Œ æ­£åœ¨è¿æ¥WebSocket...");const t=`${"http://localhost:8080"}/ws/login-notification?token=${encodeURIComponent(e)}`,o=new I(t);this.socket=o,this.socket&&(this.socket.onopen=()=>{console.log("âœ… WebSocketè¿æ¥å·²å»ºç«‹ï¼Œtokenå·²éªŒè¯"),this.isConnecting=!1,this.reconnectAttempts=0,this.isAuthenticated=!0},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("âŒ è§£æWebSocketæ¶ˆæ¯å¤±è´¥:",t)}},this.socket.onerror=e=>{console.error("âŒ WebSocketè¿æ¥é”™è¯¯:",e),this.isConnecting=!1},this.socket.onclose=t=>{console.log("ğŸ”Œ WebSocketè¿æ¥å·²å…³é—­:",t.code,t.reason),this.isConnecting=!1,this.isAuthenticated=!1,1e3!==t.code&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect(e)})}catch(o){console.error("âŒ åˆ›å»ºWebSocketè¿æ¥å¤±è´¥:",o),this.isConnecting=!1}}handleMessage(e){switch(console.log("ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯:",e),e.type){case"connected":console.log("âœ… WebSocketè¿æ¥ç¡®è®¤:",e.message);break;case"error":console.error("âŒ WebSocketé”™è¯¯:",e.message),S.error(`WebSocketé”™è¯¯: ${e.message}`);break;case"force_logout":this.handleForceLogout(e);break;case"pong":console.log("ğŸ“ æ”¶åˆ°å¿ƒè·³å“åº”:",e.message);break;case"status":console.log("ğŸ“Š WebSocketçŠ¶æ€:",e.message);break;default:console.log("â„¹ï¸ æœªçŸ¥WebSocketæ¶ˆæ¯ç±»å‹:",e.type,e)}}handleForceLogout(e){console.log("ğŸš¨ æ”¶åˆ°å¼ºåˆ¶ç™»å‡ºé€šçŸ¥:",e.message),A.alert("æ‚¨çš„è´¦æˆ·åœ¨å…¶ä»–è®¾å¤‡ä¸Šç™»å½•ï¼Œå½“å‰ä¼šè¯å°†è¢«å¼ºåˆ¶ä¸‹çº¿ã€‚","è´¦æˆ·å®‰å…¨æé†’",{confirmButtonText:"æˆ‘çŸ¥é“äº†",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).then((()=>{this.performForceLogout()})).catch((()=>{this.performForceLogout()})),S({message:"æ£€æµ‹åˆ°è´¦æˆ·åœ¨å…¶ä»–åœ°æ–¹ç™»å½•ï¼Œå³å°†è‡ªåŠ¨é€€å‡º...",type:"warning",duration:5e3,showClose:!0})}async performForceLogout(){try{console.log("ğŸšª æ‰§è¡Œå¼ºåˆ¶ç™»å‡º..."),this.disconnect(),localStorage.removeItem("fivebear-user-info"),document.cookie="fivebear-token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",window.location.href="/login?message=forced_logout",console.log("âœ… å¼ºåˆ¶ç™»å‡ºå®Œæˆ")}catch(e){console.error("âŒ å¼ºåˆ¶ç™»å‡ºå¤±è´¥:",e),window.location.reload()}}scheduleReconnect(e){this.reconnectAttempts++;const t=this.reconnectInterval*this.reconnectAttempts;console.log(`ğŸ”„ ${t}msåå°è¯•ç¬¬${this.reconnectAttempts}æ¬¡é‡è¿...`),setTimeout((()=>{this.reconnectAttempts<=this.maxReconnectAttempts?this.connect(e):(console.log("âŒ WebSocketé‡è¿å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°"),S.error("ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œå®æ—¶é€šçŸ¥åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨"))}),t)}disconnect(){this.socket&&(console.log("ğŸ”Œ ä¸»åŠ¨æ–­å¼€WebSocketè¿æ¥"),this.socket.close(1e3,"User logout"),this.socket=null,this.isAuthenticated=!1)}isConnected(){var e;return(null==(e=this.socket)?void 0:e.readyState)===WebSocket.OPEN&&this.isAuthenticated}getStatus(){var e,t;return{connected:(null==(e=this.socket)?void 0:e.readyState)===WebSocket.OPEN,authenticated:this.isAuthenticated,readyState:null==(t=this.socket)?void 0:t.readyState}}},q=3,U=1e3,j=e=>!e.response||e.response.status>=500&&e.response.status<600,D=new Map,F=e=>{const{method:t,url:o,params:n,data:r}=e;return[t,o,JSON.stringify(n),JSON.stringify(r)].join("&")},W=e=>{const t=F(e);D.delete(t)},x=P.create({baseURL:"/api",timeout:15e3,headers:{"Content-Type":"application/json;charset=UTF-8"}});x.interceptors.request.use((e=>{var t;console.log("ğŸš€ Request:",null==(t=e.method)?void 0:t.toUpperCase(),e.url),(e=>{const t=F(e);if(D.has(t)){const e=D.get(t);null==e||e.abort()}const o=new AbortController;e.signal=o.signal,D.set(t,o)})(e);const o=L.get("token");return o&&e.headers&&(e.headers.Authorization=`Bearer ${o}`),"get"===e.method&&(e.params={_t:Date.now(),...e.params}),e.data&&"object"==typeof e.data&&console.log("ğŸ“¤ Request Data:",e.data),e}),(e=>(console.error("âŒ Request Error:",e),S.error("è¯·æ±‚é…ç½®é”™è¯¯"),Promise.reject(e)))),x.interceptors.response.use((e=>{var t,o,n,r;console.log("âœ… Response:",e.status,e.config.url),W(e.config);const{data:s}=e,{code:a,message:i}=s;if(200===a)return console.log("ğŸ“¥ Response Data:",s.data),e.data=s,e;switch(console.error("âŒ Business Error:",a,i),a){case 401:{console.log("ğŸ”’ Tokenå·²è¿‡æœŸæˆ–æ— æ•ˆ"),S.error(i||"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•");V().logout(!0).catch(console.error);const e=window.location.pathname+window.location.search;return window.location.href="/login"!==e?`/login?redirect=${encodeURIComponent(e)}`:"/login",Promise.reject(new Error(i||"æœªæˆæƒ"))}case 403:return S.error(i||"æ— æƒé™è®¿é—®"),Promise.reject(new Error(i||"æ— æƒé™"));case 404:return S.error(i||"è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨"),Promise.reject(new Error(i||"èµ„æºä¸å­˜åœ¨"));case 500:return(null==(o=null==(t=e.config)?void 0:t.url)?void 0:o.includes("/auth/login"))?(null==i?void 0:i.includes("é”å®š"))?S({message:i,type:"warning",duration:5e3}):(null==i?void 0:i.includes("è¿˜å¯å°è¯•"))?S({message:i,type:"error",duration:4e3}):(null==i?void 0:i.includes("å…¶ä»–åœ°æ–¹ç™»å½•"))?S({message:i,type:"warning",duration:5e3}):S.error(i||"ç™»å½•å¤±è´¥"):S.error(i||"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"),Promise.reject(new Error(i||"æœåŠ¡å™¨é”™è¯¯"));default:return(null==(r=null==(n=e.config)?void 0:n.url)?void 0:r.includes("/auth/login"))||S.error(i||"è¯·æ±‚å¤±è´¥"),Promise.reject(new Error(i||"è¯·æ±‚å¤±è´¥"))}}),(async e=>{if(e.config&&W(e.config),P.isCancel(e))return console.log("ğŸš« Request cancelled:",e.message),Promise.reject(e);console.error("âŒ Response Error:",e);const t=e.config;if(t&&j(e)&&(t._retryCount=t._retryCount??0,t._retryCount<q))return t._retryCount++,console.log(`ğŸ”„ Retrying request (${t._retryCount}/${q})...`),await new Promise((e=>setTimeout(e,U*t._retryCount))),x(t);if(!e.response)return S.error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®"),Promise.reject(e);const{status:o,statusText:n}=e.response;switch(o){case 400:S.error("è¯·æ±‚å‚æ•°é”™è¯¯");break;case 401:{console.log("ğŸ”’ ç½‘ç»œè¯·æ±‚401 - Tokenå·²è¿‡æœŸæˆ–æ— æ•ˆ"),S.error("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•");V().logout(!0).catch(console.error);const e=window.location.pathname+window.location.search;window.location.href="/login"!==e?`/login?redirect=${encodeURIComponent(e)}`:"/login";break}case 403:S.error("æ— æƒé™è®¿é—®è¯¥èµ„æº");break;case 404:S.error("è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨");break;case 408:S.error("è¯·æ±‚è¶…æ—¶");break;case 500:S.error("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");break;case 502:S.error("ç½‘å…³é”™è¯¯");break;case 503:S.error("æœåŠ¡ä¸å¯ç”¨");break;case 504:S.error("ç½‘å…³è¶…æ—¶");break;default:S.error(n||"è¯·æ±‚å¤±è´¥")}return Promise.reject(e)}));const N={get:(e,t)=>x.get(e,t).then((e=>e.data)),post:(e,t)=>x.post(e,t).then((e=>e.data)),put:(e,t)=>x.put(e,t).then((e=>e.data)),delete:(e,t)=>x.delete(e,t).then((e=>e.data)),upload:(e,t,o)=>(e=>{const t=P.create({baseURL:"/api",timeout:6e4,headers:{"Content-Type":"multipart/form-data"}});return t.interceptors.request.use((e=>{const t=L.get("token");return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e})),t(e)})({url:e,method:"post",data:t,onUploadProgress:o}).then((e=>e.data))};class ${constructor(e){t(this,"socket",null),t(this,"url"),t(this,"token"),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",5),t(this,"reconnectInterval",3e3),t(this,"heartbeatInterval",null),t(this,"onConnectedCallback"),t(this,"onDisconnectedCallback"),t(this,"onErrorCallback"),t(this,"messageHandlers",new Map),this.token=e||this.getTokenFromCookie(),this.url=`http://localhost:8080/ws?token=${encodeURIComponent(this.token)}`}connect(){var e;try{console.log("æ­£åœ¨å»ºç«‹ç»Ÿä¸€WebSocketè¿æ¥..."),this.socket=new I(this.url),this.socket.onopen=()=>{var e;console.log("âœ… ç»Ÿä¸€WebSocketè¿æ¥å·²å»ºç«‹"),this.reconnectAttempts=0,this.startHeartbeat(),null==(e=this.onConnectedCallback)||e.call(this)},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);console.log("ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯:",t),this.handleMessage(t)}catch(t){console.error("âŒ è§£æWebSocketæ¶ˆæ¯å¤±è´¥:",t)}},this.socket.onclose=()=>{var e;console.log("ğŸ”Œ ç»Ÿä¸€WebSocketè¿æ¥å·²å…³é—­"),this.stopHeartbeat(),null==(e=this.onDisconnectedCallback)||e.call(this),this.handleReconnect()},this.socket.onerror=e=>{var t;console.error("âŒ ç»Ÿä¸€WebSocketè¿æ¥é”™è¯¯:",e),null==(t=this.onErrorCallback)||t.call(this,e)}}catch(t){console.error("âŒ åˆ›å»ºWebSocketè¿æ¥å¤±è´¥:",t),null==(e=this.onErrorCallback)||e.call(this,t)}}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.stopHeartbeat()}sendMessage(e){this.socket&&this.socket.readyState===I.OPEN?this.socket.send(JSON.stringify(e)):console.warn("âš ï¸ WebSocketæœªè¿æ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯")}handleMessage(e){const{type:t}=e;switch(t){case"FORCE_LOGOUT":this.handleForceLogout(e);break;case"SYSTEM_INFO":console.log("â„¹ï¸ ç³»ç»Ÿä¿¡æ¯:",e.message,e.data)}[...this.messageHandlers.get(t)||[],...this.messageHandlers.get("*")||[]].forEach((t=>{try{t(e)}catch(o){console.error("âŒ æ¶ˆæ¯å¤„ç†å™¨æ‰§è¡Œå¤±è´¥:",o)}}))}handleForceLogout(e){console.warn("ğŸš« æ”¶åˆ°å¼ºåˆ¶ç™»å‡ºé€šçŸ¥:",e.message);(this.messageHandlers.get("FORCE_LOGOUT")||[]).forEach((t=>t(e))),window.dispatchEvent(new CustomEvent("force-logout",{detail:e}))}startHeartbeat(){this.heartbeatInterval=setInterval((()=>{this.sendMessage({action:"PING"})}),3e4)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`ğŸ”„ å°è¯•é‡è¿... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout((()=>{this.connect()}),this.reconnectInterval)):console.error("âŒ é‡è¿å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°")}getTokenFromCookie(){return L.get("token")||""}onConnected(e){this.onConnectedCallback=e}onDisconnected(e){this.onDisconnectedCallback=e}onError(e){this.onErrorCallback=e}onMessage(e,t){this.messageHandlers.has(e)||this.messageHandlers.set(e,[]),this.messageHandlers.get(e).push(t)}offMessage(e,t){const o=this.messageHandlers.get(e);if(o){const e=o.indexOf(t);e>-1&&o.splice(e,1)}}onForceLogout(e){this.onMessage("FORCE_LOGOUT",e)}getSitesSummary(){this.sendMessage({type:"platform",action:"GET_SITES_SUMMARY"})}onSiteStatusChange(e){this.onMessage("STATUS_CHANGE",e)}onSitesSummary(e){this.onMessage("SITES_SUMMARY",e)}onRebateRateChange(e){this.onMessage("REBATE_RATE_CHANGE",e)}onPlatformMessage(e){this.onMessage("*",(t=>{["STATUS_CHANGE","SITES_SUMMARY","REBATE_RATE_CHANGE","ERROR","INFO","WARNING","SUCCESS"].includes(t.type)&&e(t)}))}}let H=null;function B(e){return H&&H.disconnect(),H=new $(e),H.connect(),H}const G="fivebear_user_info",J="token",V=o("user",(()=>{const e=e=>{try{e?localStorage.setItem(G,JSON.stringify(e)):localStorage.removeItem(G)}catch(t){console.error("ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",t)}},t=n(L.get(J)||""),o=n((()=>{try{const e=localStorage.getItem(G);return e?JSON.parse(e):null}catch(e){return console.error("è¯»å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),localStorage.removeItem(G),null}})()),r=n(!!t.value&&!!o.value),s=n(!1),a=async(e=!1)=>{try{t.value&&!e&&await N.post("/auth/logout")}catch(o){console.error("ç™»å‡ºè¯·æ±‚å¤±è´¥:",o)}finally{i(),console.log("âœ… å·²ç™»å‡ºï¼Œæ¸…é™¤æœ¬åœ°æ•°æ®")}},i=()=>{t.value="",o.value=null,r.value=!1,L.remove(J),e(null),H&&(H.disconnect(),H=null)},c=async()=>{if(!t.value)return null;try{const t=await N.get("/auth/user-info");return 200===t.code&&t.data?(o.value=t.data,e(t.data),r.value=!0,t.data):(await a(!0),null)}catch(n){return console.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",n),await a(!0),null}},l=async()=>{if(!t.value)return!1;try{return!!(await c())}catch(e){return console.error("TokenéªŒè¯å¤±è´¥:",e),await a(!0),!1}};return{token:t,userInfo:o,isLoggedIn:r,isLoading:s,login:async n=>{s.value=!0;try{const s=await N.post("/auth/login",n);if(200===s.code&&s.data){const{token:n,userInfo:i}=s.data;t.value=n,L.set(J,n,{expires:1}),o.value=i,e(i),r.value=!0;return B(n).onForceLogout((e=>{console.warn("æ”¶åˆ°å¼ºåˆ¶ç™»å‡ºé€šçŸ¥:",e.message),a(!0)})),console.log("âœ… ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯:",i),s.data}return console.error("ç™»å½•å¤±è´¥:",s.message),Promise.reject(new Error(s.message||"ç™»å½•å¤±è´¥"))}catch(i){return console.error("ç™»å½•è¯·æ±‚å¤±è´¥:",i),Promise.reject(i)}finally{s.value=!1}},logout:a,clearUserData:i,getUserInfo:c,validateToken:l,initUser:async()=>{if(console.log("ğŸ”„ åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€..."),!t.value)return console.log("âŒ æœªæ‰¾åˆ°tokenï¼Œè·³è¿‡åˆå§‹åŒ–"),i(),!1;if(!o.value){console.log("ğŸ”„ æœ‰tokenä½†æ— ç”¨æˆ·ä¿¡æ¯ï¼Œå°è¯•è·å–...");return!!(await c())}console.log("ğŸ”„ éªŒè¯ç°æœ‰tokenæœ‰æ•ˆæ€§...");const e=await l();if(e){B(t.value).onForceLogout((e=>{console.warn("æ”¶åˆ°å¼ºåˆ¶ç™»å‡ºé€šçŸ¥:",e.message),a(!0)})),console.log("âœ… ç”¨æˆ·çŠ¶æ€åˆå§‹åŒ–æˆåŠŸ")}else console.log("âŒ Tokenæ— æ•ˆï¼Œç”¨æˆ·çŠ¶æ€åˆå§‹åŒ–å¤±è´¥");return e},updateUserInfo:t=>{o.value&&(o.value={...o.value,...t},e(o.value))},refreshUserInfo:async()=>(console.log("ğŸ”„ åˆ·æ–°ç”¨æˆ·ä¿¡æ¯..."),await c()),isAdmin:()=>{var e;return 1===(null==(e=o.value)?void 0:e.roleId)},hasRole:e=>{var t;return(null==(t=o.value)?void 0:t.roleId)===e},isUserActive:()=>{var e;return 1===(null==(e=o.value)?void 0:e.status)}}})),z={key:0,class:"websocket-status"},Y=(e,t)=>{const o=e.__vccOpts||e;for(const[n,r]of t)o[n]=r;return o},K=Y(r({__name:"WebSocketStatus",setup(e){const t=V(),o=n(!1),r=n(null),k=s((()=>t.isLoggedIn)),b=s((()=>o.value?"å®æ—¶é€šçŸ¥å·²è¿æ¥":"å®æ—¶é€šçŸ¥æœªè¿æ¥")),y=s((()=>({"status-connected":o.value,"status-disconnected":!o.value}))),w=()=>{o.value=O.isConnected()};return a((()=>{w(),r.value=setInterval(w,3e3)})),i((()=>{r.value&&clearInterval(r.value)})),(e,t)=>{const n=c("el-icon"),r=c("el-tooltip");return k.value?(d(),l("div",z,[h(r,{content:b.value,placement:"bottom"},{default:m((()=>[g("div",{class:f(["status-indicator",y.value])},[h(n,{size:12},{default:m((()=>[o.value?(d(),p(v(E),{key:0})):(d(),p(v(_),{key:1}))])),_:1})],2)])),_:1},8,["content"])])):u("",!0)}}}),[["__scopeId","data-v-3c201078"]]),Q={id:"app"},X=r({__name:"App",setup:e=>(e,t)=>{const o=c("router-view");return d(),l("div",Q,[h(v(C),{locale:v(M)},{default:m((()=>[h(o),h(K)])),_:1},8,["locale"])])}}),Z={},ee=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),o=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in Z)return;Z[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,o&&r.setAttribute("nonce",o),document.head.appendChild(r),t?new Promise(((t,o)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>o(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))},te=e=>()=>((e,t,o)=>{const n=e[t];return n?"function"==typeof n?n():Promise.resolve(n):new Promise(((e,n)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==o?". Note that variables only represent file names one level deep.":""))))}))})(Object.assign({"../views/404.vue":()=>ee((()=>import("./404.CkAfTJnS.js")),__vite__mapDeps([0,1,2,3,4])),"../views/Dashboard.vue":()=>ee((()=>import("./Dashboard.DkD7UrZu.js")),__vite__mapDeps([5,2,1,3,6])),"../views/Login.vue":()=>ee((()=>import("./Login.4QHSwYmn.js")),__vite__mapDeps([7,1,2,3,8])),"../views/PlatformManager.vue":()=>ee((()=>import("./PlatformManager.ChHwjVzh.js")),__vite__mapDeps([9,2,1,10,3,11])),"../views/Sites.vue":()=>ee((()=>import("./Sites.BoV43usS.js")),__vite__mapDeps([12,2,1,10,3,13]))}),`../views/${e}.vue`,3).catch((t=>(console.error(`Failed to load component: ${e}`,t),S.error("é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•"),ee((()=>import("./404.CkAfTJnS.js")),__vite__mapDeps([0,1,2,3,4]))))),oe=[{path:"/",redirect:"/dashboard"},{path:"/dashboard",name:"Dashboard",component:te("Dashboard"),meta:{title:"ä»ªè¡¨ç›˜",icon:"dashboard",requiresAuth:!0}},{path:"/admin",name:"Admin",component:te("admin/AdminList"),meta:{title:"ç®¡ç†å‘˜ç®¡ç†",icon:"user",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/users",name:"UserManagement",component:te("admin/UserManagement"),meta:{title:"ç”¨æˆ·ç®¡ç†",icon:"user",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/roles",name:"RoleManagement",component:te("admin/RoleManagement"),meta:{title:"è§’è‰²ç®¡ç†",icon:"key",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/settings",name:"SystemSettings",component:te("admin/SystemSettings"),meta:{title:"ç³»ç»Ÿè®¾ç½®",icon:"setting",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/monitoring",name:"SystemMonitoring",component:te("admin/SystemMonitoring"),meta:{title:"ç³»ç»Ÿç›‘æ§",icon:"monitor",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/logs",name:"LogManagement",component:te("admin/LogManagement"),meta:{title:"æ—¥å¿—ç®¡ç†",icon:"files",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/security",name:"SecurityCenter",component:te("admin/SecurityCenter"),meta:{title:"å®‰å…¨ä¸­å¿ƒ",icon:"lock",requiresAuth:!0,requiresAdmin:!0}},{path:"/report",name:"Report",component:te("report/ReportDashboard"),meta:{title:"æŠ¥è¡¨ç®¡ç†",icon:"chart",requiresAuth:!0}},{path:"/shipment",name:"Shipment",component:te("shipment/ShipmentList"),meta:{title:"å‡ºè´§ç®¡ç†",icon:"box",requiresAuth:!0}},{path:"/sites",name:"Sites",component:te("admin/Sites"),meta:{title:"ç«™ç‚¹ç®¡ç†",icon:"monitor",requiresAuth:!0}},{path:"/login",name:"Login",component:te("Login"),meta:{title:"ç™»å½•",hideInMenu:!0,guest:!0}},{path:"/:pathMatch(.*)*",name:"NotFound",component:te("404"),meta:{title:"é¡µé¢ä¸å­˜åœ¨",hideInMenu:!0}}],ne=k({history:b("/"),routes:oe,scrollBehavior:(e,t,o)=>o||(e.hash?{el:e.hash,behavior:"smooth"}:{top:0})});"requestIdleCallback"in window&&requestIdleCallback((()=>{ee((()=>import("./Dashboard.DkD7UrZu.js")),__vite__mapDeps([5,2,1,3,6])),ee((()=>import("./Sites.CB1LDPkl.js")),__vite__mapDeps([14,10,2,1,3,15]))}));const re=["/login","/404"];ne.beforeEach((async(e,t,o)=>{var n,r,s,a;console.log(`ğŸ›£ï¸ è·¯ç”±è·³è½¬: ${t.path} -> ${e.path}`),(null==(n=e.meta)?void 0:n.title)&&"string"==typeof e.meta.title&&(document.title=`${e.meta.title} - FiveBearä¼ä¸šç®¡ç†ç³»ç»Ÿ`);const i=V();if(re.includes(e.path))return(null==(r=e.meta)?void 0:r.guest)&&i.isLoggedIn?(console.log("ğŸ‘¤ å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µï¼Œè·³è½¬åˆ°é¦–é¡µ"),void o("/dashboard")):void o();if(null==(s=e.meta)?void 0:s.requiresAuth){if(!i.isLoggedIn){console.log("ğŸ”’ é¡µé¢éœ€è¦è®¤è¯ï¼Œåˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€...");if(!(await i.initUser()))return console.log("âŒ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),S.warning("è¯·å…ˆç™»å½•"),void o({path:"/login",query:{redirect:e.fullPath}})}if(!i.isUserActive())return console.log("âŒ ç”¨æˆ·è´¦æˆ·å·²è¢«ç¦ç”¨"),S.error("è´¦æˆ·å·²è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"),await i.logout(!0),void o("/login");if((null==(a=e.meta)?void 0:a.requiresAdmin)&&!i.isAdmin())return console.log("âŒ æ— ç®¡ç†å‘˜æƒé™"),S.error("æ— æƒé™è®¿é—®è¯¥é¡µé¢"),void o("/dashboard");console.log("âœ… è®¤è¯é€šè¿‡ï¼Œå…è®¸è®¿é—®")}o()})),ne.onError((e=>{console.error("ğŸš¨ è·¯ç”±é”™è¯¯:",e),S.error("é¡µé¢åŠ è½½å¤±è´¥")}));const se=y(X);for(const[ae,ie]of Object.entries(R))se.component(ae,ie);se.use(w()),se.use(ne),se.use(T);(async()=>{console.log("ğŸš€ FiveBear ç³»ç»Ÿå¯åŠ¨ä¸­...");const e=V();try{await e.initUser(),console.log("âœ… ç”¨æˆ·çŠ¶æ€åˆå§‹åŒ–å®Œæˆ")}catch(t){console.error("âŒ ç”¨æˆ·çŠ¶æ€åˆå§‹åŒ–å¤±è´¥:",t)}console.log("âœ… FiveBear ç³»ç»Ÿå¯åŠ¨å®Œæˆ")})().catch((e=>{console.error("ğŸš¨ åº”ç”¨å¯åŠ¨å¤±è´¥:",e)})).finally((()=>{se.mount("#app")}));export{Y as _,N as r,x as s,V as u};
