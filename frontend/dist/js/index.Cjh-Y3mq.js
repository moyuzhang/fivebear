const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/404.CkAfTJnS.js","js/vue-vendor.C3rdx7ZB.js","js/element-plus.BDp-1BTq.js","js/utils.3cDF09Hu.js","css/404.CXua_yea.css","js/Dashboard.DkD7UrZu.js","css/Dashboard.BZ9UlbPX.css","js/Login.4QHSwYmn.js","css/Login.DoGwGpxB.css","js/PlatformManager.ChHwjVzh.js","js/platform.D35QYocM.js","css/PlatformManager.BbtwROAG.css","js/Sites.BoV43usS.js","css/Sites.CG2TwVGp.css","js/Sites.CB1LDPkl.js","css/Sites.uq30_hvp.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,o,n)=>((t,o,n)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n)(t,"symbol"!=typeof o?o+"":o,n);import{aw as o,r as n,x as r,c as s,h as a,S as i,ag as c,y as l,J as u,z as d,P as h,H as m,A as g,G as p,u as v,D as f,ax as k,ay as b,at as y,az as w}from"./vue-vendor.C3rdx7ZB.js";import{E as S,a as A,c as E,b as _,d as C,e as R,i as T}from"./element-plus.BDp-1BTq.js";import{S as I,a as P,b as L}from"./utils.3cDF09Hu.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var M={name:"zh-cn",el:{breadcrumb:{label:"面包屑"},colorpicker:{confirm:"确定",clear:"清空",defaultLabel:"颜色选择器",description:"当前颜色 {color}，按 Enter 键选择新颜色",alphaLabel:"选择透明度的值"},datepicker:{now:"此刻",today:"今天",cancel:"取消",clear:"清空",confirm:"确定",dateTablePrompt:"使用方向键与 Enter 键可选择日期",monthTablePrompt:"使用方向键与 Enter 键可选择月份",yearTablePrompt:"使用方向键与 Enter 键可选择年份",selectedDate:"已选日期",selectDate:"选择日期",selectTime:"选择时间",startDate:"开始日期",startTime:"开始时间",endDate:"结束日期",endTime:"结束时间",prevYear:"前一年",nextYear:"后一年",prevMonth:"上个月",nextMonth:"下个月",year:"年",month1:"1 月",month2:"2 月",month3:"3 月",month4:"4 月",month5:"5 月",month6:"6 月",month7:"7 月",month8:"8 月",month9:"9 月",month10:"10 月",month11:"11 月",month12:"12 月",weeks:{sun:"日",mon:"一",tue:"二",wed:"三",thu:"四",fri:"五",sat:"六"},weeksFull:{sun:"星期日",mon:"星期一",tue:"星期二",wed:"星期三",thu:"星期四",fri:"星期五",sat:"星期六"},months:{jan:"一月",feb:"二月",mar:"三月",apr:"四月",may:"五月",jun:"六月",jul:"七月",aug:"八月",sep:"九月",oct:"十月",nov:"十一月",dec:"十二月"}},inputNumber:{decrease:"减少数值",increase:"增加数值"},select:{loading:"加载中",noMatch:"无匹配数据",noData:"无数据",placeholder:"请选择"},dropdown:{toggleDropdown:"切换下拉选项"},mention:{loading:"加载中"},cascader:{noMatch:"无匹配数据",loading:"加载中",placeholder:"请选择",noData:"暂无数据"},pagination:{goto:"前往",pagesize:"条/页",total:"共 {total} 条",pageClassifier:"页",page:"页",prev:"上一页",next:"下一页",currentPage:"第 {pager} 页",prevPages:"向前 {pager} 页",nextPages:"向后 {pager} 页",deprecationWarning:"你使用了一些已被废弃的用法，请参考 el-pagination 的官方文档"},dialog:{close:"关闭此对话框"},drawer:{close:"关闭此对话框"},messagebox:{title:"提示",confirm:"确定",cancel:"取消",error:"输入的数据不合法!",close:"关闭此对话框"},upload:{deleteTip:"按 Delete 键可删除",delete:"删除",preview:"查看图片",continue:"继续上传"},slider:{defaultLabel:"滑块介于 {min} 至 {max}",defaultRangeStartLabel:"选择起始值",defaultRangeEndLabel:"选择结束值"},table:{emptyText:"暂无数据",confirmFilter:"筛选",resetFilter:"重置",clearFilter:"全部",sumText:"合计"},tour:{next:"下一步",previous:"上一步",finish:"结束导览"},tree:{emptyText:"暂无数据"},transfer:{noMatch:"无匹配数据",noData:"无数据",titles:["列表 1","列表 2"],filterPlaceholder:"请输入搜索内容",noCheckedFormat:"共 {total} 项",hasCheckedFormat:"已选 {checked}/{total} 项"},image:{error:"加载失败"},pageHeader:{title:"返回"},popconfirm:{confirmButtonText:"确定",cancelButtonText:"取消"},carousel:{leftArrow:"上一张幻灯片",rightArrow:"下一张幻灯片",indicator:"幻灯片切换至索引 {index}"}}};const O=new class{constructor(){t(this,"socket",null),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",5),t(this,"reconnectInterval",3e3),t(this,"isConnecting",!1),t(this,"isAuthenticated",!1)}connect(e){var t;if((null==(t=this.socket)?void 0:t.readyState)!==WebSocket.OPEN&&!this.isConnecting)try{this.isConnecting=!0,console.log("🔌 正在连接WebSocket...");const t=`${"http://localhost:8080"}/ws/login-notification?token=${encodeURIComponent(e)}`,o=new I(t);this.socket=o,this.socket&&(this.socket.onopen=()=>{console.log("✅ WebSocket连接已建立，token已验证"),this.isConnecting=!1,this.reconnectAttempts=0,this.isAuthenticated=!0},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("❌ 解析WebSocket消息失败:",t)}},this.socket.onerror=e=>{console.error("❌ WebSocket连接错误:",e),this.isConnecting=!1},this.socket.onclose=t=>{console.log("🔌 WebSocket连接已关闭:",t.code,t.reason),this.isConnecting=!1,this.isAuthenticated=!1,1e3!==t.code&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect(e)})}catch(o){console.error("❌ 创建WebSocket连接失败:",o),this.isConnecting=!1}}handleMessage(e){switch(console.log("📨 收到WebSocket消息:",e),e.type){case"connected":console.log("✅ WebSocket连接确认:",e.message);break;case"error":console.error("❌ WebSocket错误:",e.message),S.error(`WebSocket错误: ${e.message}`);break;case"force_logout":this.handleForceLogout(e);break;case"pong":console.log("🏓 收到心跳响应:",e.message);break;case"status":console.log("📊 WebSocket状态:",e.message);break;default:console.log("ℹ️ 未知WebSocket消息类型:",e.type,e)}}handleForceLogout(e){console.log("🚨 收到强制登出通知:",e.message),A.alert("您的账户在其他设备上登录，当前会话将被强制下线。","账户安全提醒",{confirmButtonText:"我知道了",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).then((()=>{this.performForceLogout()})).catch((()=>{this.performForceLogout()})),S({message:"检测到账户在其他地方登录，即将自动退出...",type:"warning",duration:5e3,showClose:!0})}async performForceLogout(){try{console.log("🚪 执行强制登出..."),this.disconnect(),localStorage.removeItem("fivebear-user-info"),document.cookie="fivebear-token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",window.location.href="/login?message=forced_logout",console.log("✅ 强制登出完成")}catch(e){console.error("❌ 强制登出失败:",e),window.location.reload()}}scheduleReconnect(e){this.reconnectAttempts++;const t=this.reconnectInterval*this.reconnectAttempts;console.log(`🔄 ${t}ms后尝试第${this.reconnectAttempts}次重连...`),setTimeout((()=>{this.reconnectAttempts<=this.maxReconnectAttempts?this.connect(e):(console.log("❌ WebSocket重连失败，已达到最大重试次数"),S.error("网络连接不稳定，实时通知功能暂时不可用"))}),t)}disconnect(){this.socket&&(console.log("🔌 主动断开WebSocket连接"),this.socket.close(1e3,"User logout"),this.socket=null,this.isAuthenticated=!1)}isConnected(){var e;return(null==(e=this.socket)?void 0:e.readyState)===WebSocket.OPEN&&this.isAuthenticated}getStatus(){var e,t;return{connected:(null==(e=this.socket)?void 0:e.readyState)===WebSocket.OPEN,authenticated:this.isAuthenticated,readyState:null==(t=this.socket)?void 0:t.readyState}}},q=3,U=1e3,j=e=>!e.response||e.response.status>=500&&e.response.status<600,D=new Map,F=e=>{const{method:t,url:o,params:n,data:r}=e;return[t,o,JSON.stringify(n),JSON.stringify(r)].join("&")},W=e=>{const t=F(e);D.delete(t)},x=P.create({baseURL:"/api",timeout:15e3,headers:{"Content-Type":"application/json;charset=UTF-8"}});x.interceptors.request.use((e=>{var t;console.log("🚀 Request:",null==(t=e.method)?void 0:t.toUpperCase(),e.url),(e=>{const t=F(e);if(D.has(t)){const e=D.get(t);null==e||e.abort()}const o=new AbortController;e.signal=o.signal,D.set(t,o)})(e);const o=L.get("token");return o&&e.headers&&(e.headers.Authorization=`Bearer ${o}`),"get"===e.method&&(e.params={_t:Date.now(),...e.params}),e.data&&"object"==typeof e.data&&console.log("📤 Request Data:",e.data),e}),(e=>(console.error("❌ Request Error:",e),S.error("请求配置错误"),Promise.reject(e)))),x.interceptors.response.use((e=>{var t,o,n,r;console.log("✅ Response:",e.status,e.config.url),W(e.config);const{data:s}=e,{code:a,message:i}=s;if(200===a)return console.log("📥 Response Data:",s.data),e.data=s,e;switch(console.error("❌ Business Error:",a,i),a){case 401:{console.log("🔒 Token已过期或无效"),S.error(i||"登录已过期，请重新登录");V().logout(!0).catch(console.error);const e=window.location.pathname+window.location.search;return window.location.href="/login"!==e?`/login?redirect=${encodeURIComponent(e)}`:"/login",Promise.reject(new Error(i||"未授权"))}case 403:return S.error(i||"无权限访问"),Promise.reject(new Error(i||"无权限"));case 404:return S.error(i||"请求的资源不存在"),Promise.reject(new Error(i||"资源不存在"));case 500:return(null==(o=null==(t=e.config)?void 0:t.url)?void 0:o.includes("/auth/login"))?(null==i?void 0:i.includes("锁定"))?S({message:i,type:"warning",duration:5e3}):(null==i?void 0:i.includes("还可尝试"))?S({message:i,type:"error",duration:4e3}):(null==i?void 0:i.includes("其他地方登录"))?S({message:i,type:"warning",duration:5e3}):S.error(i||"登录失败"):S.error(i||"服务器内部错误"),Promise.reject(new Error(i||"服务器错误"));default:return(null==(r=null==(n=e.config)?void 0:n.url)?void 0:r.includes("/auth/login"))||S.error(i||"请求失败"),Promise.reject(new Error(i||"请求失败"))}}),(async e=>{if(e.config&&W(e.config),P.isCancel(e))return console.log("🚫 Request cancelled:",e.message),Promise.reject(e);console.error("❌ Response Error:",e);const t=e.config;if(t&&j(e)&&(t._retryCount=t._retryCount??0,t._retryCount<q))return t._retryCount++,console.log(`🔄 Retrying request (${t._retryCount}/${q})...`),await new Promise((e=>setTimeout(e,U*t._retryCount))),x(t);if(!e.response)return S.error("网络连接失败，请检查网络设置"),Promise.reject(e);const{status:o,statusText:n}=e.response;switch(o){case 400:S.error("请求参数错误");break;case 401:{console.log("🔒 网络请求401 - Token已过期或无效"),S.error("登录已过期，请重新登录");V().logout(!0).catch(console.error);const e=window.location.pathname+window.location.search;window.location.href="/login"!==e?`/login?redirect=${encodeURIComponent(e)}`:"/login";break}case 403:S.error("无权限访问该资源");break;case 404:S.error("请求的资源不存在");break;case 408:S.error("请求超时");break;case 500:S.error("服务器内部错误");break;case 502:S.error("网关错误");break;case 503:S.error("服务不可用");break;case 504:S.error("网关超时");break;default:S.error(n||"请求失败")}return Promise.reject(e)}));const N={get:(e,t)=>x.get(e,t).then((e=>e.data)),post:(e,t)=>x.post(e,t).then((e=>e.data)),put:(e,t)=>x.put(e,t).then((e=>e.data)),delete:(e,t)=>x.delete(e,t).then((e=>e.data)),upload:(e,t,o)=>(e=>{const t=P.create({baseURL:"/api",timeout:6e4,headers:{"Content-Type":"multipart/form-data"}});return t.interceptors.request.use((e=>{const t=L.get("token");return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e})),t(e)})({url:e,method:"post",data:t,onUploadProgress:o}).then((e=>e.data))};class ${constructor(e){t(this,"socket",null),t(this,"url"),t(this,"token"),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",5),t(this,"reconnectInterval",3e3),t(this,"heartbeatInterval",null),t(this,"onConnectedCallback"),t(this,"onDisconnectedCallback"),t(this,"onErrorCallback"),t(this,"messageHandlers",new Map),this.token=e||this.getTokenFromCookie(),this.url=`http://localhost:8080/ws?token=${encodeURIComponent(this.token)}`}connect(){var e;try{console.log("正在建立统一WebSocket连接..."),this.socket=new I(this.url),this.socket.onopen=()=>{var e;console.log("✅ 统一WebSocket连接已建立"),this.reconnectAttempts=0,this.startHeartbeat(),null==(e=this.onConnectedCallback)||e.call(this)},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);console.log("📨 收到WebSocket消息:",t),this.handleMessage(t)}catch(t){console.error("❌ 解析WebSocket消息失败:",t)}},this.socket.onclose=()=>{var e;console.log("🔌 统一WebSocket连接已关闭"),this.stopHeartbeat(),null==(e=this.onDisconnectedCallback)||e.call(this),this.handleReconnect()},this.socket.onerror=e=>{var t;console.error("❌ 统一WebSocket连接错误:",e),null==(t=this.onErrorCallback)||t.call(this,e)}}catch(t){console.error("❌ 创建WebSocket连接失败:",t),null==(e=this.onErrorCallback)||e.call(this,t)}}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.stopHeartbeat()}sendMessage(e){this.socket&&this.socket.readyState===I.OPEN?this.socket.send(JSON.stringify(e)):console.warn("⚠️ WebSocket未连接，无法发送消息")}handleMessage(e){const{type:t}=e;switch(t){case"FORCE_LOGOUT":this.handleForceLogout(e);break;case"SYSTEM_INFO":console.log("ℹ️ 系统信息:",e.message,e.data)}[...this.messageHandlers.get(t)||[],...this.messageHandlers.get("*")||[]].forEach((t=>{try{t(e)}catch(o){console.error("❌ 消息处理器执行失败:",o)}}))}handleForceLogout(e){console.warn("🚫 收到强制登出通知:",e.message);(this.messageHandlers.get("FORCE_LOGOUT")||[]).forEach((t=>t(e))),window.dispatchEvent(new CustomEvent("force-logout",{detail:e}))}startHeartbeat(){this.heartbeatInterval=setInterval((()=>{this.sendMessage({action:"PING"})}),3e4)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`🔄 尝试重连... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout((()=>{this.connect()}),this.reconnectInterval)):console.error("❌ 重连失败，已达到最大尝试次数")}getTokenFromCookie(){return L.get("token")||""}onConnected(e){this.onConnectedCallback=e}onDisconnected(e){this.onDisconnectedCallback=e}onError(e){this.onErrorCallback=e}onMessage(e,t){this.messageHandlers.has(e)||this.messageHandlers.set(e,[]),this.messageHandlers.get(e).push(t)}offMessage(e,t){const o=this.messageHandlers.get(e);if(o){const e=o.indexOf(t);e>-1&&o.splice(e,1)}}onForceLogout(e){this.onMessage("FORCE_LOGOUT",e)}getSitesSummary(){this.sendMessage({type:"platform",action:"GET_SITES_SUMMARY"})}onSiteStatusChange(e){this.onMessage("STATUS_CHANGE",e)}onSitesSummary(e){this.onMessage("SITES_SUMMARY",e)}onRebateRateChange(e){this.onMessage("REBATE_RATE_CHANGE",e)}onPlatformMessage(e){this.onMessage("*",(t=>{["STATUS_CHANGE","SITES_SUMMARY","REBATE_RATE_CHANGE","ERROR","INFO","WARNING","SUCCESS"].includes(t.type)&&e(t)}))}}let H=null;function B(e){return H&&H.disconnect(),H=new $(e),H.connect(),H}const G="fivebear_user_info",J="token",V=o("user",(()=>{const e=e=>{try{e?localStorage.setItem(G,JSON.stringify(e)):localStorage.removeItem(G)}catch(t){console.error("保存用户信息失败:",t)}},t=n(L.get(J)||""),o=n((()=>{try{const e=localStorage.getItem(G);return e?JSON.parse(e):null}catch(e){return console.error("读取用户信息失败:",e),localStorage.removeItem(G),null}})()),r=n(!!t.value&&!!o.value),s=n(!1),a=async(e=!1)=>{try{t.value&&!e&&await N.post("/auth/logout")}catch(o){console.error("登出请求失败:",o)}finally{i(),console.log("✅ 已登出，清除本地数据")}},i=()=>{t.value="",o.value=null,r.value=!1,L.remove(J),e(null),H&&(H.disconnect(),H=null)},c=async()=>{if(!t.value)return null;try{const t=await N.get("/auth/user-info");return 200===t.code&&t.data?(o.value=t.data,e(t.data),r.value=!0,t.data):(await a(!0),null)}catch(n){return console.error("获取用户信息失败:",n),await a(!0),null}},l=async()=>{if(!t.value)return!1;try{return!!(await c())}catch(e){return console.error("Token验证失败:",e),await a(!0),!1}};return{token:t,userInfo:o,isLoggedIn:r,isLoading:s,login:async n=>{s.value=!0;try{const s=await N.post("/auth/login",n);if(200===s.code&&s.data){const{token:n,userInfo:i}=s.data;t.value=n,L.set(J,n,{expires:1}),o.value=i,e(i),r.value=!0;return B(n).onForceLogout((e=>{console.warn("收到强制登出通知:",e.message),a(!0)})),console.log("✅ 登录成功，用户信息:",i),s.data}return console.error("登录失败:",s.message),Promise.reject(new Error(s.message||"登录失败"))}catch(i){return console.error("登录请求失败:",i),Promise.reject(i)}finally{s.value=!1}},logout:a,clearUserData:i,getUserInfo:c,validateToken:l,initUser:async()=>{if(console.log("🔄 初始化用户状态..."),!t.value)return console.log("❌ 未找到token，跳过初始化"),i(),!1;if(!o.value){console.log("🔄 有token但无用户信息，尝试获取...");return!!(await c())}console.log("🔄 验证现有token有效性...");const e=await l();if(e){B(t.value).onForceLogout((e=>{console.warn("收到强制登出通知:",e.message),a(!0)})),console.log("✅ 用户状态初始化成功")}else console.log("❌ Token无效，用户状态初始化失败");return e},updateUserInfo:t=>{o.value&&(o.value={...o.value,...t},e(o.value))},refreshUserInfo:async()=>(console.log("🔄 刷新用户信息..."),await c()),isAdmin:()=>{var e;return 1===(null==(e=o.value)?void 0:e.roleId)},hasRole:e=>{var t;return(null==(t=o.value)?void 0:t.roleId)===e},isUserActive:()=>{var e;return 1===(null==(e=o.value)?void 0:e.status)}}})),z={key:0,class:"websocket-status"},Y=(e,t)=>{const o=e.__vccOpts||e;for(const[n,r]of t)o[n]=r;return o},K=Y(r({__name:"WebSocketStatus",setup(e){const t=V(),o=n(!1),r=n(null),k=s((()=>t.isLoggedIn)),b=s((()=>o.value?"实时通知已连接":"实时通知未连接")),y=s((()=>({"status-connected":o.value,"status-disconnected":!o.value}))),w=()=>{o.value=O.isConnected()};return a((()=>{w(),r.value=setInterval(w,3e3)})),i((()=>{r.value&&clearInterval(r.value)})),(e,t)=>{const n=c("el-icon"),r=c("el-tooltip");return k.value?(d(),l("div",z,[h(r,{content:b.value,placement:"bottom"},{default:m((()=>[g("div",{class:f(["status-indicator",y.value])},[h(n,{size:12},{default:m((()=>[o.value?(d(),p(v(E),{key:0})):(d(),p(v(_),{key:1}))])),_:1})],2)])),_:1},8,["content"])])):u("",!0)}}}),[["__scopeId","data-v-3c201078"]]),Q={id:"app"},X=r({__name:"App",setup:e=>(e,t)=>{const o=c("router-view");return d(),l("div",Q,[h(v(C),{locale:v(M)},{default:m((()=>[h(o),h(K)])),_:1},8,["locale"])])}}),Z={},ee=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),o=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in Z)return;Z[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,o&&r.setAttribute("nonce",o),document.head.appendChild(r),t?new Promise(((t,o)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>o(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))},te=e=>()=>((e,t,o)=>{const n=e[t];return n?"function"==typeof n?n():Promise.resolve(n):new Promise(((e,n)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==o?". Note that variables only represent file names one level deep.":""))))}))})(Object.assign({"../views/404.vue":()=>ee((()=>import("./404.CkAfTJnS.js")),__vite__mapDeps([0,1,2,3,4])),"../views/Dashboard.vue":()=>ee((()=>import("./Dashboard.DkD7UrZu.js")),__vite__mapDeps([5,2,1,3,6])),"../views/Login.vue":()=>ee((()=>import("./Login.4QHSwYmn.js")),__vite__mapDeps([7,1,2,3,8])),"../views/PlatformManager.vue":()=>ee((()=>import("./PlatformManager.ChHwjVzh.js")),__vite__mapDeps([9,2,1,10,3,11])),"../views/Sites.vue":()=>ee((()=>import("./Sites.BoV43usS.js")),__vite__mapDeps([12,2,1,10,3,13]))}),`../views/${e}.vue`,3).catch((t=>(console.error(`Failed to load component: ${e}`,t),S.error("页面加载失败，请刷新重试"),ee((()=>import("./404.CkAfTJnS.js")),__vite__mapDeps([0,1,2,3,4]))))),oe=[{path:"/",redirect:"/dashboard"},{path:"/dashboard",name:"Dashboard",component:te("Dashboard"),meta:{title:"仪表盘",icon:"dashboard",requiresAuth:!0}},{path:"/admin",name:"Admin",component:te("admin/AdminList"),meta:{title:"管理员管理",icon:"user",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/users",name:"UserManagement",component:te("admin/UserManagement"),meta:{title:"用户管理",icon:"user",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/roles",name:"RoleManagement",component:te("admin/RoleManagement"),meta:{title:"角色管理",icon:"key",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/settings",name:"SystemSettings",component:te("admin/SystemSettings"),meta:{title:"系统设置",icon:"setting",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/monitoring",name:"SystemMonitoring",component:te("admin/SystemMonitoring"),meta:{title:"系统监控",icon:"monitor",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/logs",name:"LogManagement",component:te("admin/LogManagement"),meta:{title:"日志管理",icon:"files",requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/security",name:"SecurityCenter",component:te("admin/SecurityCenter"),meta:{title:"安全中心",icon:"lock",requiresAuth:!0,requiresAdmin:!0}},{path:"/report",name:"Report",component:te("report/ReportDashboard"),meta:{title:"报表管理",icon:"chart",requiresAuth:!0}},{path:"/shipment",name:"Shipment",component:te("shipment/ShipmentList"),meta:{title:"出货管理",icon:"box",requiresAuth:!0}},{path:"/sites",name:"Sites",component:te("admin/Sites"),meta:{title:"站点管理",icon:"monitor",requiresAuth:!0}},{path:"/login",name:"Login",component:te("Login"),meta:{title:"登录",hideInMenu:!0,guest:!0}},{path:"/:pathMatch(.*)*",name:"NotFound",component:te("404"),meta:{title:"页面不存在",hideInMenu:!0}}],ne=k({history:b("/"),routes:oe,scrollBehavior:(e,t,o)=>o||(e.hash?{el:e.hash,behavior:"smooth"}:{top:0})});"requestIdleCallback"in window&&requestIdleCallback((()=>{ee((()=>import("./Dashboard.DkD7UrZu.js")),__vite__mapDeps([5,2,1,3,6])),ee((()=>import("./Sites.CB1LDPkl.js")),__vite__mapDeps([14,10,2,1,3,15]))}));const re=["/login","/404"];ne.beforeEach((async(e,t,o)=>{var n,r,s,a;console.log(`🛣️ 路由跳转: ${t.path} -> ${e.path}`),(null==(n=e.meta)?void 0:n.title)&&"string"==typeof e.meta.title&&(document.title=`${e.meta.title} - FiveBear企业管理系统`);const i=V();if(re.includes(e.path))return(null==(r=e.meta)?void 0:r.guest)&&i.isLoggedIn?(console.log("👤 已登录用户访问登录页，跳转到首页"),void o("/dashboard")):void o();if(null==(s=e.meta)?void 0:s.requiresAuth){if(!i.isLoggedIn){console.log("🔒 页面需要认证，初始化用户状态...");if(!(await i.initUser()))return console.log("❌ 用户未登录，跳转到登录页"),S.warning("请先登录"),void o({path:"/login",query:{redirect:e.fullPath}})}if(!i.isUserActive())return console.log("❌ 用户账户已被禁用"),S.error("账户已被禁用，请联系管理员"),await i.logout(!0),void o("/login");if((null==(a=e.meta)?void 0:a.requiresAdmin)&&!i.isAdmin())return console.log("❌ 无管理员权限"),S.error("无权限访问该页面"),void o("/dashboard");console.log("✅ 认证通过，允许访问")}o()})),ne.onError((e=>{console.error("🚨 路由错误:",e),S.error("页面加载失败")}));const se=y(X);for(const[ae,ie]of Object.entries(R))se.component(ae,ie);se.use(w()),se.use(ne),se.use(T);(async()=>{console.log("🚀 FiveBear 系统启动中...");const e=V();try{await e.initUser(),console.log("✅ 用户状态初始化完成")}catch(t){console.error("❌ 用户状态初始化失败:",t)}console.log("✅ FiveBear 系统启动完成")})().catch((e=>{console.error("🚨 应用启动失败:",e)})).finally((()=>{se.mount("#app")}));export{Y as _,N as r,x as s,V as u};
