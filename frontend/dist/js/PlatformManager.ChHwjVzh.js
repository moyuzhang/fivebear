import{E as e,w as a,F as l,a as s}from"./element-plus.BDp-1BTq.js";import{r as t,x as u,h as o,S as n,n as r,ag as i,aq as d,y as c,z as v,A as m,J as p,P as y,D as g,M as _,H as b,L as f,u as w,I as h,G as C,O as R,a6 as T}from"./vue-vendor.C3rdx7ZB.js";import{g as V,P as k,a as L,l as O,b as G,d as E,c as x,e as F}from"./platform.D35QYocM.js";import{_ as I}from"./index.Cjh-Y3mq.js";import"./utils.3cDF09Hu.js";function U(e=!1){const a=t(e),l=()=>{a.value=!0},s=()=>{a.value=!1};return{loading:a,startLoading:l,stopLoading:s,withLoading:async e=>{l();try{return await e()}finally{s()}}}}const q={class:"platform-manager"},N={class:"header"},D={class:"header-left"},K={class:"connection-status"},S={class:"status-text"},z={class:"header-right"},j={class:"stats-section"},M={class:"stats-grid"},B={class:"stat-card"},P={class:"stat-number"},$={class:"stat-card logged-in"},A={class:"stat-number"},W={class:"stat-card not-logged-in"},H={class:"stat-number"},J={class:"stat-card error"},Y={class:"stat-number"},Q={key:0,class:"batch-operations"},X={class:"selected-count"},Z={class:"batch-buttons"},ee={class:"sites-table"},ae={class:"dialog-footer"},le={key:0,class:"site-detail"},se={class:"detail-item"},te={class:"detail-item"},ue={class:"detail-item"},oe={class:"detail-item"},ne={class:"detail-item"},re={class:"detail-item"},ie={class:"detail-item"},de={class:"detail-item"},ce={class:"detail-item"},ve={class:"message-log"},me={class:"log-header"},pe={class:"message-time"},ye={class:"message-content"},ge=I(u({__name:"PlatformManager",setup(u){const{loading:I,withLoading:ge}=U(),{loading:_e,withLoading:be}=U(),{loading:fe}=U(),{loading:we}=U(),{loading:he}=U(),Ce=t({totalCount:0,statusCounts:{},sites:[],userId:"",timestamp:0}),Re=t("disconnected"),Te=t("未连接"),Ve=t(null),ke=t([]),Le=t([]),Oe=t(!1),Ge=t({url:"",username:"",password:"",rebateRate:1e-4,lotteryType:1,clientType:1}),Ee={url:[{required:!0,message:"请输入站点URL",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},xe=t(),Fe=t(!1),Ie=t(null),Ue=t();o((()=>{qe(),Ne()})),n((()=>{Ve.value&&Ve.value.disconnect()}));const qe=async()=>{await ge((async()=>{try{const a=await V();a.success?Ce.value=a.data:e.error(a.message)}catch(a){console.error("Failed to load sites:",a),e.error("加载站点数据失败")}}))},Ne=()=>{Ve.value=new k,Ve.value.onStatusChange((e=>{Re.value=e,Te.value={connected:"已连接",disconnected:"未连接",error:"连接错误"}[e]||"未知状态"})),Ve.value.onMessage((e=>{De(e.type,e.message,e.timestamp),"SITES_SUMMARY"===e.type&&e.data&&(Ce.value=e.data)})),Ve.value.connect()},De=(e,a,l)=>{const s=l||(new Date).toLocaleTimeString();ke.value.unshift({type:e,message:a,timestamp:s}),ke.value.length>100&&(ke.value=ke.value.slice(0,100)),r((()=>{Ue.value&&(Ue.value.scrollTop=0)}))},Ke=()=>{ke.value=[]},Se=()=>{qe(),Ve.value&&Ve.value.getSitesSummary()},ze=e=>{Le.value=e},je=e=>({LOGGED_IN:"success",NOT_LOGGED_IN:"info",LOGGING_IN:"warning",ERROR:"danger",NETWORK_ERROR:"danger",LOGGED_OUT:"info"}[e]||"info"),Me=async()=>{xe.value&&await xe.value.validate((async a=>{a&&await be((async()=>{try{const a=await L(Ge.value);a.success?(e.success("站点添加成功"),Oe.value=!1,Be(),qe()):e.error(a.message)}catch(a){console.error("Failed to add site:",a),e.error("添加站点失败")}}))}))},Be=()=>{Ge.value={url:"",username:"",password:"",rebateRate:1e-4,lotteryType:1,clientType:1},xe.value&&xe.value.resetFields()},Pe=async()=>{fe.value=!0;try{const a=Le.value.map((e=>e.uniqueKey)),l=await F({uniqueKeys:a});l.success?e.success("批量登录操作已提交"):e.error(l.message)}catch(a){console.error("Failed to batch login:",a),e.error("批量登录失败")}finally{fe.value=!1}},$e=async()=>{we.value=!0;try{Le.value.map((e=>e.uniqueKey));e.success("批量登出功能待实现")}catch(a){console.error("Failed to batch logout:",a),e.error("批量登出失败")}finally{we.value=!1}},Ae=async()=>{try{await s.confirm(`确定要删除选中的 ${Le.value.length} 个站点吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),he.value=!0;const l=Le.value.map((e=>E(e.uniqueKey)));try{await Promise.all(l),e.success("批量删除成功"),qe()}catch(a){e.error("部分站点删除失败")}}catch(a){"cancel"!==a&&(console.error("Failed to batch delete:",a),e.error("批量删除失败"))}finally{he.value=!1}};return(t,u)=>{const o=i("el-icon"),n=i("el-button"),r=i("el-table-column"),V=i("el-tag"),k=i("el-table"),L=i("el-input"),F=i("el-form-item"),U=i("el-input-number"),ge=i("el-option"),be=i("el-select"),Ve=i("el-form"),Ne=i("el-dialog"),De=d("loading");return v(),c("div",q,[m("div",N,[m("div",D,[u[10]||(u[10]=m("h2",null,"站点管理",-1)),m("div",K,[m("span",{class:g(["status-indicator",Re.value])},null,2),m("span",S,_(Te.value),1)])]),m("div",z,[y(n,{type:"primary",onClick:u[0]||(u[0]=e=>Oe.value=!0)},{default:b((()=>[y(o,null,{default:b((()=>[y(w(a))])),_:1}),u[11]||(u[11]=f(" 添加站点 "))])),_:1,__:[11]}),y(n,{onClick:Se},{default:b((()=>[y(o,null,{default:b((()=>[y(w(l))])),_:1}),u[12]||(u[12]=f(" 刷新 "))])),_:1,__:[12]})])]),m("div",j,[m("div",M,[m("div",B,[m("div",P,_(Ce.value.totalCount),1),u[13]||(u[13]=m("div",{class:"stat-label"},"总站点数",-1))]),m("div",$,[m("div",A,_(Ce.value.statusCounts.LOGGED_IN||0),1),u[14]||(u[14]=m("div",{class:"stat-label"},"已登录",-1))]),m("div",W,[m("div",H,_(Ce.value.statusCounts.NOT_LOGGED_IN||0),1),u[15]||(u[15]=m("div",{class:"stat-label"},"未登录",-1))]),m("div",J,[m("div",Y,_((Ce.value.statusCounts.ERROR||0)+(Ce.value.statusCounts.NETWORK_ERROR||0)),1),u[16]||(u[16]=m("div",{class:"stat-label"},"异常",-1))])])]),Le.value.length>0?(v(),c("div",Q,[m("span",X,"已选择 "+_(Le.value.length)+" 个站点",1),m("div",Z,[y(n,{type:"success",onClick:Pe,loading:w(fe)},{default:b((()=>u[17]||(u[17]=[f(" 批量登录 ")]))),_:1,__:[17]},8,["loading"]),y(n,{type:"warning",onClick:$e,loading:w(we)},{default:b((()=>u[18]||(u[18]=[f(" 批量登出 ")]))),_:1,__:[18]},8,["loading"]),y(n,{type:"danger",onClick:Ae,loading:w(he)},{default:b((()=>u[19]||(u[19]=[f(" 批量删除 ")]))),_:1,__:[19]},8,["loading"])])])):p("",!0),m("div",ee,[h((v(),C(k,{data:Ce.value.sites,onSelectionChange:ze,stripe:"",border:""},{default:b((()=>[y(r,{type:"selection",width:"55"}),y(r,{prop:"username",label:"用户名",width:"120"}),y(r,{prop:"domain",label:"域名",width:"200"}),y(r,{label:"状态",width:"120"},{default:b((e=>[y(V,{type:je(e.row.status),size:"small"},{default:b((()=>[f(_(e.row.statusDescription),1)])),_:2},1032,["type"])])),_:1}),y(r,{prop:"rebateRate",label:"返点率",width:"100"},{default:b((e=>[f(_((100*e.row.rebateRate).toFixed(2))+"% ",1)])),_:1}),y(r,{prop:"siteType",label:"站点类型",width:"100"}),y(r,{prop:"lotteryType",label:"彩种",width:"80"}),y(r,{label:"操作",width:"200"},{default:b((a=>["NOT_LOGGED_IN"===a.row.status?(v(),C(n,{key:0,type:"success",size:"small",onClick:l=>(async a=>{try{const l=await O(a.uniqueKey);l.success?e.success("登录操作已提交"):e.error(l.message)}catch(l){console.error("Failed to login site:",l),e.error("登录站点失败")}})(a.row)},{default:b((()=>u[20]||(u[20]=[f(" 登录 ")]))),_:2,__:[20]},1032,["onClick"])):p("",!0),"LOGGED_IN"===a.row.status?(v(),C(n,{key:1,type:"warning",size:"small",onClick:l=>(async a=>{try{const l=await G(a.uniqueKey);l.success?e.success("登出操作已提交"):e.error(l.message)}catch(l){console.error("Failed to logout site:",l),e.error("登出站点失败")}})(a.row)},{default:b((()=>u[21]||(u[21]=[f(" 登出 ")]))),_:2,__:[21]},1032,["onClick"])):p("",!0),y(n,{type:"info",size:"small",onClick:l=>(async a=>{try{const l=await x(a.uniqueKey);l.success?(Ie.value=l.data,Fe.value=!0):e.error(l.message)}catch(l){console.error("Failed to get site detail:",l),e.error("获取站点详情失败")}})(a.row)},{default:b((()=>u[22]||(u[22]=[f(" 详情 ")]))),_:2,__:[22]},1032,["onClick"]),y(n,{type:"danger",size:"small",onClick:l=>(async a=>{try{await s.confirm(`确定要删除站点 ${a.username}@${a.domain} 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=await E(a.uniqueKey);l.success?(e.success("站点删除成功"),qe()):e.error(l.message)}catch(l){"cancel"!==l&&(console.error("Failed to delete site:",l),e.error("删除站点失败"))}})(a.row)},{default:b((()=>u[23]||(u[23]=[f(" 删除 ")]))),_:2,__:[23]},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[De,w(I)]])]),y(Ne,{modelValue:Oe.value,"onUpdate:modelValue":u[8]||(u[8]=e=>Oe.value=e),title:"添加站点",width:"600px"},{footer:b((()=>[m("span",ae,[y(n,{onClick:u[7]||(u[7]=e=>Oe.value=!1)},{default:b((()=>u[24]||(u[24]=[f("取消")]))),_:1,__:[24]}),y(n,{type:"primary",onClick:Me,loading:w(_e)},{default:b((()=>u[25]||(u[25]=[f(" 确定 ")]))),_:1,__:[25]},8,["loading"])])])),default:b((()=>[y(Ve,{model:Ge.value,rules:Ee,ref_key:"siteFormRef",ref:xe,"label-width":"120px"},{default:b((()=>[y(F,{label:"站点URL",prop:"url"},{default:b((()=>[y(L,{modelValue:Ge.value.url,"onUpdate:modelValue":u[1]||(u[1]=e=>Ge.value.url=e),placeholder:"请输入站点URL"},null,8,["modelValue"])])),_:1}),y(F,{label:"用户名",prop:"username"},{default:b((()=>[y(L,{modelValue:Ge.value.username,"onUpdate:modelValue":u[2]||(u[2]=e=>Ge.value.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),y(F,{label:"密码",prop:"password"},{default:b((()=>[y(L,{modelValue:Ge.value.password,"onUpdate:modelValue":u[3]||(u[3]=e=>Ge.value.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1}),y(F,{label:"返点率"},{default:b((()=>[y(U,{modelValue:Ge.value.rebateRate,"onUpdate:modelValue":u[4]||(u[4]=e=>Ge.value.rebateRate=e),min:0,max:1,step:1e-4,precision:4,placeholder:"0.0000"},null,8,["modelValue"])])),_:1}),y(F,{label:"彩种类型"},{default:b((()=>[y(be,{modelValue:Ge.value.lotteryType,"onUpdate:modelValue":u[5]||(u[5]=e=>Ge.value.lotteryType=e),placeholder:"请选择彩种类型"},{default:b((()=>[y(ge,{label:"五分彩",value:1}),y(ge,{label:"十分彩",value:2}),y(ge,{label:"十五分彩",value:3})])),_:1},8,["modelValue"])])),_:1}),y(F,{label:"客户端类型"},{default:b((()=>[y(be,{modelValue:Ge.value.clientType,"onUpdate:modelValue":u[6]||(u[6]=e=>Ge.value.clientType=e),placeholder:"请选择客户端类型"},{default:b((()=>[y(ge,{label:"会员端",value:1}),y(ge,{label:"管理端",value:2})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),y(Ne,{modelValue:Fe.value,"onUpdate:modelValue":u[9]||(u[9]=e=>Fe.value=e),title:"站点详情",width:"600px"},{default:b((()=>[Ie.value?(v(),c("div",le,[m("div",se,[u[26]||(u[26]=m("label",null,"唯一标识：",-1)),m("span",null,_(Ie.value.uniqueKey),1)]),m("div",te,[u[27]||(u[27]=m("label",null,"用户名：",-1)),m("span",null,_(Ie.value.username),1)]),m("div",ue,[u[28]||(u[28]=m("label",null,"域名：",-1)),m("span",null,_(Ie.value.domain),1)]),m("div",oe,[u[29]||(u[29]=m("label",null,"完整URL：",-1)),m("span",null,_(Ie.value.url),1)]),m("div",ne,[u[30]||(u[30]=m("label",null,"状态：",-1)),y(V,{type:je(Ie.value.status)},{default:b((()=>[f(_(Ie.value.statusDescription),1)])),_:1},8,["type"])]),m("div",re,[u[31]||(u[31]=m("label",null,"返点率：",-1)),m("span",null,_((100*Ie.value.rebateRate).toFixed(4))+"%",1)]),m("div",ie,[u[32]||(u[32]=m("label",null,"站点类型：",-1)),m("span",null,_(Ie.value.siteType),1)]),m("div",de,[u[33]||(u[33]=m("label",null,"彩种类型：",-1)),m("span",null,_(Ie.value.lotteryType),1)]),m("div",ce,[u[34]||(u[34]=m("label",null,"数据库ID：",-1)),m("span",null,_(Ie.value.databaseId),1)])])):p("",!0)])),_:1},8,["modelValue"]),m("div",ve,[m("div",me,[u[36]||(u[36]=m("h4",null,"实时消息",-1)),y(n,{size:"small",onClick:Ke},{default:b((()=>u[35]||(u[35]=[f("清空")]))),_:1,__:[35]})]),m("div",{class:"log-content",ref_key:"logContent",ref:Ue},[(v(!0),c(R,null,T(ke.value,((e,a)=>(v(),c("div",{key:a,class:g(["message-item",e.type.toLowerCase()])},[m("span",pe,_(e.timestamp),1),m("span",ye,_(e.message),1)],2)))),128))],512)])])}}}),[["__scopeId","data-v-cb7eb485"]]);export{ge as default};
