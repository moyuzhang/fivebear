var e=Object.defineProperty,t=(t,s,o)=>((t,s,o)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o)(t,"symbol"!=typeof s?s+"":s,o);import{s}from"./index.Cjh-Y3mq.js";function o(){return s({url:"/api/platform/sites",method:"get",headers:{"User-ID":localStorage.getItem("userId")||"72"}})}function n(e){return s({url:"/api/platform/sites",method:"post",data:e,headers:{"User-ID":localStorage.getItem("userId")||"72"}})}function a(e){return s({url:`/api/platform/sites/${e}/login`,method:"post",headers:{"User-ID":localStorage.getItem("userId")||"72"}})}function r(e){return s({url:`/api/platform/sites/${e}/logout`,method:"post",headers:{"User-ID":localStorage.getItem("userId")||"72"}})}function c(e){return s({url:`/api/platform/sites/${e}`,method:"delete",headers:{"User-ID":localStorage.getItem("userId")||"72"}})}function l(e){return s({url:`/api/platform/sites/${e}`,method:"get",headers:{"User-ID":localStorage.getItem("userId")||"72"}})}function i(e){return s({url:"/api/platform/sites/batch/login",method:"post",data:e,headers:{"User-ID":localStorage.getItem("userId")||"72"}})}class h{constructor(e){t(this,"ws",null),t(this,"url"),t(this,"token"),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",5),t(this,"reconnectInterval",3e3),t(this,"onMessageCallback"),t(this,"onStatusChangeCallback"),this.token=e||this.getTokenFromCookie(),this.url=`ws://localhost:8080/platform/ws?token=${this.token}`}getTokenFromCookie(){const e=document.cookie.split(";");for(const t of e){const[e,s]=t.trim().split("=");if("token"===e)return decodeURIComponent(s)}return""}connect(){try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{var e;console.log("Platform WebSocket connected"),this.reconnectAttempts=0,null==(e=this.onStatusChangeCallback)||e.call(this,"connected")},this.ws.onmessage=e=>{var t;try{const s=JSON.parse(e.data);console.log("Platform WebSocket message:",s),null==(t=this.onMessageCallback)||t.call(this,s)}catch(s){console.error("Failed to parse WebSocket message:",s)}},this.ws.onclose=()=>{var e;console.log("Platform WebSocket disconnected"),null==(e=this.onStatusChangeCallback)||e.call(this,"disconnected"),this.handleReconnect()},this.ws.onerror=e=>{var t;console.error("Platform WebSocket error:",e),null==(t=this.onStatusChangeCallback)||t.call(this,"error")}}catch(e){console.error("Failed to create WebSocket connection:",e)}}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}sendMessage(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}onMessage(e){this.onMessageCallback=e}onStatusChange(e){this.onStatusChangeCallback=e}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout((()=>{this.connect()}),this.reconnectInterval))}ping(){this.sendMessage({action:"PING"})}getSitesSummary(){this.sendMessage({action:"GET_SITES_SUMMARY"})}}export{h as P,n as a,r as b,l as c,c as d,i as e,o as g,a as l};
