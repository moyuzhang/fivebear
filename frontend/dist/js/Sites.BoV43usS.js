import{E as e,w as a,F as l,a as s}from"./element-plus.BDp-1BTq.js";import{g as t,P as u,a as r,l as o,b as n,d as c,e as d}from"./platform.D35QYocM.js";import{x as i,r as m,h as v,S as p,ag as _,aq as y,y as f,z as g,A as b,P as w,J as h,L as R,D as C,M as V,H as k,u as O,I as T,G,O as E,a6 as N}from"./vue-vendor.C3rdx7ZB.js";import{_ as I}from"./index.Cjh-Y3mq.js";import"./utils.3cDF09Hu.js";const L={class:"sites-page"},U={class:"page-header"},q={class:"header-actions"},S={class:"connection-status"},D={class:"stats-grid"},K={class:"stat-card total"},x={class:"stat-content"},z={class:"stat-number"},j={class:"stat-card success"},M={class:"stat-content"},F={class:"stat-number"},P={class:"stat-card warning"},$={class:"stat-content"},A={class:"stat-number"},W={class:"stat-card danger"},H={class:"stat-content"},J={class:"stat-number"},Y={key:0,class:"batch-actions"},B={class:"card-header"},Q={class:"message-list"},X={class:"message-time"},Z={class:"message-content"},ee=I(i({__name:"Sites",setup(i){const I=m(!1),ee=m(!1),ae=m(!1),le=m([]),se=m("disconnected"),te=m("未连接"),ue=m([]),re=m({totalCount:0,statusCounts:{},sites:[],userId:"",timestamp:0}),oe=m({url:"",username:"",password:"",rebateRate:1e-4,lotteryType:1,clientType:1}),ne={url:[{required:!0,message:"请输入站点URL",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},ce=m();let de=null;v((()=>{ie(),me()})),p((()=>{de&&de.disconnect()}));const ie=async()=>{I.value=!0;try{const a=await t();a.success?re.value=a.data:e.error(a.message)}catch(a){e.error("加载数据失败")}finally{I.value=!1}},me=()=>{de=new u,de.onStatusChange((e=>{se.value=e,te.value="connected"===e?"已连接":"error"===e?"连接错误":"未连接"})),de.onMessage((e=>{ve(e.message,e.timestamp),"SITES_SUMMARY"===e.type&&e.data&&(re.value=e.data)})),de.connect()},ve=(e,a)=>{const l=a||(new Date).toLocaleTimeString();ue.value.unshift({message:e,timestamp:l}),ue.value.length>50&&(ue.value=ue.value.slice(0,50))},pe=()=>{ue.value=[]},_e=()=>{ie(),de&&de.getSitesSummary()},ye=e=>{le.value=e},fe=async()=>{ce.value&&await ce.value.validate((async a=>{if(a){ee.value=!0;try{const a=await r(oe.value);a.success?(e.success("添加成功"),ae.value=!1,ge(),ie()):e.error(a.message)}catch(l){e.error("添加失败")}finally{ee.value=!1}}}))},ge=()=>{oe.value={url:"",username:"",password:"",rebateRate:1e-4,lotteryType:1,clientType:1},ce.value&&ce.value.resetFields()},be=async()=>{try{const a=le.value.map((e=>e.uniqueKey)),l=await d({uniqueKeys:a});l.success?e.success("批量登录操作已提交"):e.error(l.message)}catch(a){e.error("批量登录失败")}},we=async()=>{try{await s.confirm(`确定删除选中的 ${le.value.length} 个站点吗？`,"确认批量删除");const a=le.value.map((e=>c(e.uniqueKey)));await Promise.all(a),e.success("批量删除成功"),ie()}catch(a){"cancel"!==a&&e.error("批量删除失败")}};return(t,u)=>{const r=_("el-icon"),d=_("el-button"),i=_("el-table-column"),m=_("el-tag"),v=_("el-table"),p=_("el-card"),de=_("el-input"),me=_("el-form-item"),ve=_("el-input-number"),ge=_("el-option"),he=_("el-select"),Re=_("el-form"),Ce=_("el-dialog"),Ve=y("loading");return g(),f("div",L,[b("div",U,[u[11]||(u[11]=b("h2",null,"站点管理",-1)),b("div",q,[b("div",S,[b("span",{class:C(["status-dot",se.value])},null,2),R(" "+V(te.value),1)]),w(d,{type:"primary",onClick:u[0]||(u[0]=e=>ae.value=!0)},{default:k((()=>[w(r,null,{default:k((()=>[w(O(a))])),_:1}),u[9]||(u[9]=R(" 添加站点 "))])),_:1,__:[9]}),w(d,{onClick:_e},{default:k((()=>[w(r,null,{default:k((()=>[w(O(l))])),_:1}),u[10]||(u[10]=R(" 刷新 "))])),_:1,__:[10]})])]),b("div",D,[b("div",K,[u[13]||(u[13]=b("div",{class:"stat-icon"},"🏢",-1)),b("div",x,[b("div",z,V(re.value.totalCount),1),u[12]||(u[12]=b("div",{class:"stat-label"},"总站点数",-1))])]),b("div",j,[u[15]||(u[15]=b("div",{class:"stat-icon"},"✅",-1)),b("div",M,[b("div",F,V(re.value.statusCounts.LOGGED_IN||0),1),u[14]||(u[14]=b("div",{class:"stat-label"},"已登录",-1))])]),b("div",P,[u[17]||(u[17]=b("div",{class:"stat-icon"},"⏳",-1)),b("div",$,[b("div",A,V(re.value.statusCounts.NOT_LOGGED_IN||0),1),u[16]||(u[16]=b("div",{class:"stat-label"},"未登录",-1))])]),b("div",W,[u[19]||(u[19]=b("div",{class:"stat-icon"},"❌",-1)),b("div",H,[b("div",J,V((re.value.statusCounts.ERROR||0)+(re.value.statusCounts.NETWORK_ERROR||0)),1),u[18]||(u[18]=b("div",{class:"stat-label"},"异常",-1))])])]),w(p,{class:"table-card"},{default:k((()=>[T((g(),G(v,{data:re.value.sites,onSelectionChange:ye,stripe:""},{default:k((()=>[w(i,{type:"selection",width:"55"}),w(i,{prop:"username",label:"用户名",width:"120"}),w(i,{prop:"domain",label:"域名",width:"200"}),w(i,{label:"状态",width:"120"},{default:k((e=>{return[w(m,{type:(a=e.row.status,{LOGGED_IN:"success",NOT_LOGGED_IN:"info",LOGGING_IN:"warning",ERROR:"danger",NETWORK_ERROR:"danger"}[a]||"info"),size:"small"},{default:k((()=>[R(V(e.row.statusDescription),1)])),_:2},1032,["type"])];var a})),_:1}),w(i,{prop:"rebateRate",label:"返点率",width:"100"},{default:k((e=>[R(V((100*e.row.rebateRate).toFixed(2))+"% ",1)])),_:1}),w(i,{prop:"siteType",label:"站点类型",width:"100"}),w(i,{prop:"lotteryType",label:"彩种",width:"80"}),w(i,{label:"操作",width:"200"},{default:k((a=>["NOT_LOGGED_IN"===a.row.status?(g(),G(d,{key:0,type:"success",size:"small",onClick:l=>(async a=>{try{const l=await o(a.uniqueKey);l.success?e.success("登录操作已提交"):e.error(l.message)}catch(l){e.error("登录失败")}})(a.row)},{default:k((()=>u[20]||(u[20]=[R(" 登录 ")]))),_:2,__:[20]},1032,["onClick"])):h("",!0),"LOGGED_IN"===a.row.status?(g(),G(d,{key:1,type:"warning",size:"small",onClick:l=>(async a=>{try{const l=await n(a.uniqueKey);l.success?e.success("登出操作已提交"):e.error(l.message)}catch(l){e.error("登出失败")}})(a.row)},{default:k((()=>u[21]||(u[21]=[R(" 登出 ")]))),_:2,__:[21]},1032,["onClick"])):h("",!0),w(d,{type:"danger",size:"small",onClick:l=>(async a=>{try{await s.confirm(`确定删除站点 ${a.username}@${a.domain} 吗？`,"确认删除");const l=await c(a.uniqueKey);l.success?(e.success("删除成功"),ie()):e.error(l.message)}catch(l){"cancel"!==l&&e.error("删除失败")}})(a.row)},{default:k((()=>u[22]||(u[22]=[R(" 删除 ")]))),_:2,__:[22]},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Ve,I.value]])])),_:1}),le.value.length>0?(g(),f("div",Y,[b("span",null,"已选择 "+V(le.value.length)+" 个站点",1),w(d,{type:"success",onClick:be},{default:k((()=>u[23]||(u[23]=[R("批量登录")]))),_:1,__:[23]}),w(d,{type:"danger",onClick:we},{default:k((()=>u[24]||(u[24]=[R("批量删除")]))),_:1,__:[24]})])):h("",!0),w(Ce,{modelValue:ae.value,"onUpdate:modelValue":u[8]||(u[8]=e=>ae.value=e),title:"添加站点",width:"500px"},{footer:k((()=>[w(d,{onClick:u[7]||(u[7]=e=>ae.value=!1)},{default:k((()=>u[25]||(u[25]=[R("取消")]))),_:1,__:[25]}),w(d,{type:"primary",onClick:fe,loading:ee.value},{default:k((()=>u[26]||(u[26]=[R("确定")]))),_:1,__:[26]},8,["loading"])])),default:k((()=>[w(Re,{model:oe.value,rules:ne,ref_key:"formRef",ref:ce,"label-width":"100px"},{default:k((()=>[w(me,{label:"站点URL",prop:"url"},{default:k((()=>[w(de,{modelValue:oe.value.url,"onUpdate:modelValue":u[1]||(u[1]=e=>oe.value.url=e),placeholder:"请输入站点URL"},null,8,["modelValue"])])),_:1}),w(me,{label:"用户名",prop:"username"},{default:k((()=>[w(de,{modelValue:oe.value.username,"onUpdate:modelValue":u[2]||(u[2]=e=>oe.value.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),w(me,{label:"密码",prop:"password"},{default:k((()=>[w(de,{modelValue:oe.value.password,"onUpdate:modelValue":u[3]||(u[3]=e=>oe.value.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1}),w(me,{label:"返点率"},{default:k((()=>[w(ve,{modelValue:oe.value.rebateRate,"onUpdate:modelValue":u[4]||(u[4]=e=>oe.value.rebateRate=e),min:0,max:1,step:1e-4,precision:4},null,8,["modelValue"])])),_:1}),w(me,{label:"彩种类型"},{default:k((()=>[w(he,{modelValue:oe.value.lotteryType,"onUpdate:modelValue":u[5]||(u[5]=e=>oe.value.lotteryType=e)},{default:k((()=>[w(ge,{label:"五分彩",value:1}),w(ge,{label:"十分彩",value:2}),w(ge,{label:"十五分彩",value:3})])),_:1},8,["modelValue"])])),_:1}),w(me,{label:"客户端类型"},{default:k((()=>[w(he,{modelValue:oe.value.clientType,"onUpdate:modelValue":u[6]||(u[6]=e=>oe.value.clientType=e)},{default:k((()=>[w(ge,{label:"会员端",value:1}),w(ge,{label:"管理端",value:2})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),w(p,{class:"message-card"},{header:k((()=>[b("div",B,[u[28]||(u[28]=b("span",null,"实时消息",-1)),w(d,{size:"small",onClick:pe},{default:k((()=>u[27]||(u[27]=[R("清空")]))),_:1,__:[27]})])])),default:k((()=>[b("div",Q,[(g(!0),f(E,null,N(ue.value,((e,a)=>(g(),f("div",{key:a,class:"message-item"},[b("span",X,V(e.timestamp),1),b("span",Z,V(e.message),1)])))),128))])])),_:1})])}}}),[["__scopeId","data-v-3a4697a9"]]);export{ee as default};
