# 退出登录功能测试指南

## 🎯 测试目标
验证完整的退出登录功能，包括：
- 用户界面的退出操作
- 后端登出API调用
- 本地数据清理
- 重定向到登录页面
- 多标签页状态同步

## 🚀 测试环境准备

### 1. 确保服务运行
- **前端**: http://localhost:3001
- **后端**: http://localhost:8080

### 2. 测试账户
```
用户名: admin
密码: Aa147258
```

## 📝 测试步骤

### 步骤1: 访问系统并登录

1. 打开浏览器访问: `http://localhost:3001`
2. 应该自动跳转到登录页面 (如果未登录)
3. 使用测试账户登录
4. 登录成功后跳转到 Dashboard 页面

**预期结果**:
- ✅ 显示用户信息和导航栏
- ✅ 右上角显示用户头像和昵称
- ✅ Console显示: "✅ 用户状态初始化完成"

### 步骤2: 验证用户状态显示

在Dashboard页面检查：

1. **导航栏**:
   - 显示 "🐻 FiveBear企业管理系统"
   - 右上角显示用户头像 (昵称首字母)
   - 显示用户昵称

2. **用户信息卡片**:
   - 显示用户头像
   - 显示 "您好，[昵称]！"
   - 显示角色信息
   - 显示账户状态为"正常"

**预期结果**:
- ✅ 所有用户信息正确显示
- ✅ localStorage中有用户信息
- ✅ Cookie中有token

### 步骤3: 测试退出登录UI

1. **点击用户下拉菜单**:
   - 点击右上角的用户信息区域
   - 查看下拉菜单是否显示

2. **菜单选项**:
   - "个人信息" (开发中)
   - "系统设置" (开发中)  
   - "退出登录" (分隔线)

**预期结果**:
- ✅ 下拉菜单正常显示
- ✅ 退出登录选项在最下方且有分隔线

### 步骤4: 执行退出登录

1. **点击"退出登录"**:
   - 应该弹出确认对话框
   - 标题: "退出确认"
   - 内容: "确认要退出登录吗？"
   - 按钮: "确定" 和 "取消"

2. **测试取消退出**:
   - 点击"取消"按钮
   - 应该关闭对话框，保持登录状态

3. **确认退出**:
   - 点击"确定"按钮
   - 应该显示 "退出中..." 提示

**预期结果**:
- ✅ 确认对话框正常显示
- ✅ 取消操作不会退出
- ✅ Console显示: "🚪 用户确认退出登录"

### 步骤5: 验证退出登录流程

确认退出后，观察以下变化：

1. **网络请求**:
   - 发送 POST `/auth/logout` 请求
   - 携带 Authorization 头

2. **本地数据清理**:
   - localStorage 中的用户信息被清除
   - Cookie 中的 token 被删除
   - Pinia store 状态重置

3. **页面跳转**:
   - 显示 "已成功退出登录" 成功提示
   - 自动跳转到登录页面

**预期结果**:
- ✅ 后端接收到登出请求
- ✅ 本地数据完全清理
- ✅ Console显示: "✅ 退出登录成功，跳转到登录页"
- ✅ 成功跳转到 `/login`

### 步骤6: 验证退出后状态

在跳转到登录页面后：

1. **页面状态**:
   - 显示登录表单
   - 没有用户信息显示
   - 没有导航栏

2. **尝试访问受保护页面**:
   - 手动访问 `http://localhost:3001/dashboard`
   - 应该自动跳转到登录页面
   - URL应该包含重定向参数: `/login?redirect=%2Fdashboard`

**预期结果**:
- ✅ 显示正常的登录页面
- ✅ 无法直接访问受保护页面
- ✅ Console显示: "❌ 未找到token，跳过初始化"

### 步骤7: 测试多标签页同步 (高级测试)

1. **打开多个标签页**:
   - 登录后在新标签页打开系统
   - 在其中一个标签页退出登录

2. **验证同步效果**:
   - 其他标签页应该也自动退出 (刷新页面时)
   - 或者显示token过期提示

## 🔍 Console日志监控

在浏览器开发者工具Console中，应该看到以下日志：

```
登录时:
🔄 初始化用户状态...
✅ 登录成功，用户信息: {...}
✅ 用户状态初始化完成

退出时:
🚪 用户确认退出登录
🚀 Request: POST /auth/logout
✅ Response: 200 /auth/logout
✅ 已登出，清除本地数据
✅ 退出登录成功，跳转到登录页
🛣️ 路由跳转: /dashboard -> /login
```

## 🐛 常见问题排查

### 问题1: 退出登录按钮不显示
- 检查用户是否已登录
- 检查userStore.userInfo是否有值
- 检查Navigation组件是否正确导入

### 问题2: 退出登录无反应
- 检查Console是否有JavaScript错误
- 检查后端是否正在运行
- 检查网络请求是否发送成功

### 问题3: 退出后仍能访问受保护页面
- 检查路由守卫是否正确配置
- 检查token是否真正被清除
- 检查localStorage和Cookie

### 问题4: 多标签页不同步
- 这是预期行为，需要刷新页面才会检查登录状态
- 可以通过storage事件实现实时同步 (后续功能)

## ✅ 测试检查表

- [ ] 能够正常登录并显示用户信息
- [ ] 导航栏用户下拉菜单正常显示
- [ ] 点击退出登录显示确认对话框
- [ ] 取消退出不会登出系统
- [ ] 确认退出会发送网络请求
- [ ] 本地数据 (localStorage + Cookie) 被清理
- [ ] 成功跳转到登录页面
- [ ] 退出后无法访问受保护页面
- [ ] Console日志信息正确显示
- [ ] 重新登录功能正常

---

**测试完成后，如果所有功能正常，说明退出登录优化成功！** 🎉 